---
title: "PGLS with Full Data Set"
output: html_notebook
---


#Load in packages 
```{r}
library(tidyverse)
library(rfishbase)
library (ggplot2)
library(Hmisc)
library(phytools)
library(here)
library(ape)
library(geiger)
library(nlme)
library(patchwork)
library(emmeans)
library(multcompView)
library(readxl)
library(plotly) 
library(ggthemes) 
library(naniar)
library(dplyr)
```

#Load in csv
```{r}
fullvertmeas <- read.csv("MasterVert_Measurements.csv")
head(fullvertmeas)
```

#Load in phylogenetic information
```{r}
treefile <- '12862_2017_958_MOESM2_ESM.tre'
```

```{r}
tree <- read.tree(here('..', treefile))
```

```{r}
plotTree(tree)
```

```{r}
allspecies <- as.data.frame(tree$tip.label, stringsAsFactors = FALSE) 
colnames(allspecies) <- c('FullName')
```

```{r}
allspecies <- 
  allspecies %>% separate(FullName, sep='_', into=c('Family', 'Genus', 'Species'), 
                          extra='drop', remove=FALSE)
```

```{r}
allspecies$Tip <- seq_len(nrow(allspecies))
```

```{r}
fullvertmeas.mean <- fullvertmeas %>%
  group_by(Species, Body.Shape, Habitat) %>%
  summarise_at(vars(d, CBL, D_Pos, alpha_Pos, D_Ant, alpha_Ant, d_BW, D_Pos_BW, D_Ant_BW), 
               list(mean = ~mean(.x, na.rm=TRUE), 
                    max = ~max(.x, na.rm=TRUE))) %>%
  ungroup() %>%
  separate(Species, sep='_', into=c("Genus", "Species"))
```










